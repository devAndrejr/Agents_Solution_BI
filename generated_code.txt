import pandas as pd
import plotly.express as px
import os

# Caminho para o diretório dos arquivos Parquet
parquet_dir = r'C:\Users\André\Documents\Agent_BI\data\parquet_cleaned'

# Carregar dados do arquivo 'admatao.parquet'
df = pd.read_parquet(os.path.join(parquet_dir, "admatao.parquet"))

# Converter a coluna 'PRODUTO' para string e minúsculas
df['PRODUTO'] = df['PRODUTO'].astype(str).str.lower()

# Filtrar os dados para o produto específico
produto_id = "610403"
df_produto = df[df['PRODUTO'] == produto_id]

# Converter colunas de vendas mensais para numérico
for i in range(1, 13):
    mes_coluna = f'MES_{i:02d}'
    if mes_coluna in df_produto.columns:
        df_produto[mes_coluna] = pd.to_numeric(df_produto[mes_coluna], errors='coerce').fillna(0)

# Preparar dados para o gráfico
meses = [f'Mês {i:02d}' for i in range(1, 13)]
vendas = [df_produto[f'MES_{i:02d}'].sum() for i in range(1, 13)]

# Criar um DataFrame para o gráfico
df_vendas = pd.DataFrame({
    'Mês': meses,
    'Vendas': vendas
})

# Criar o gráfico de linha
fig = px.line(df_vendas, x='Mês', y='Vendas', title=f'Vendas Mensais do Produto {produto_id}')

# Armazenar o resultado
result = fig